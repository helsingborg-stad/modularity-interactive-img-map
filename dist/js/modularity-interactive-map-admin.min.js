var ModularityInteractiveMap=ModularityInteractiveMap||{};ModularityInteractiveMap.MapImage=function(t){function e(){this.handleEvents(),1==t('[name="interactive-map-is-selected"]').val()&&this.mapSelected()}var a;return e.prototype.handleEvents=function(){t('[data-action="interactive-map-add-layer"]').on("click",function(t){t.preventDefault(),this.openMediaModal()}.bind(this)),t('[data-action="interactive-map-remove-image"]').on("click",function(t){t.preventDefault(),this.removeMap()}.bind(this))},e.prototype.openMediaModal=function(e){return a?(a.open(),void t(".media-router a:first-of-type").trigger("click")):void this.setupMediaModal()},e.prototype.setupMediaModal=function(){a=wp.media({title:"Map image",button:{text:"Select"},multiple:!1}),a.on("select",function(){var t=a.state().get("selection").first().toJSON();"undefined"!=typeof t&&this.mapSelected(t)}.bind(this)),this.openMediaModal()},e.prototype.mapSelected=function(e){t("[data-map-editor-no-map]").hide(),t("[data-map-editor]").show(),"undefined"!=typeof e&&(t("#map-image .map-container").append('<img src="'+e.url+'">'),t(".no-map").remove(),t("#map-layers").append('<li>                <input type="hidden" name="interactive-map-layers['+e.id+'][id]" value="'+e.id+'">                <input type="text" name="interactive-map-layers['+e.id+'][name]" value="'+e.title+'">            </li>'))},e.prototype.removeMap=function(){t("[data-map-editor-no-map]").show(),t("[data-map-editor]").hide(),t("#map-image .map-container img").remove(),t('[name="interactive-map-image-id"]').val("")},new e}(jQuery);var ModularityInteractiveMap=ModularityInteractiveMap||{};ModularityInteractiveMap.MapPinCategories=function(t){function e(){this.handleEvents()}var a=0;return e.prototype.handleEvents=function(){t('[data-action="interactive-map-add-pin-category"]').on("click",function(t){t.preventDefault(),this.addCategory()}.bind(this)),t(document).on("click",'[data-action="interactive-map-add-remove-category"]',function(e){e.preventDefault();var a=t(e.target).closest('[data-action="interactive-map-add-remove-category"]');this.removeCategory(a.attr("data-category-name"))}.bind(this)),t(document).on("change",".map-pin [data-map-category-selector]",function(e){var a=t(this).parents(".map-pin"),i=t(this).find("option:selected").attr("data-color");a.css("backgroundColor",i)})},e.prototype.getSelector=function(e,a){var i=this.getAll("numeric"),n=t('<select class="widefat" name="'+e+'" data-map-category-selector></select>');return"undefined"==typeof a&&(a=null),t.each(i,function(t,e){return e.name===a?void n.append('<option style="color:'+e.color+';" value="'+e.name+'" data-color="'+e.color+'" selected>'+e.name+"</option>"):void n.append('<option style="color:'+e.color+';" value="'+e.name+'" data-color="'+e.color+'">'+e.name+"</option>")}.bind(this)),n[0].outerHTML},e.prototype.updateSelectors=function(e,a){t("[data-map-category-selector]").append('<option style="color:'+a+';" value="'+e+'" data-color="'+a+'">'+e+"</option>")},e.prototype.getAll=function(e){"undefined"==typeof e&&(e="name");var a=[],i=t(".interactive-map-categories-list li");return i.each(function(i,n){var o=t(this).find("[data-map-category]").val(),p=t(this).find("[data-map-category-color]").val(),r=[];r.name=o,r.color=p,"numeric"===e?a.push(r):a[o]=r}),a},e.prototype.addCategory=function(e,i){0===a&&(a=t(".interactive-map-categories-list li").length),a++,"undefined"==typeof e&&(e=t('[name="map-category-name"]').val()),"undefined"==typeof i&&(i=t('[name="map-category-pin-color"]').val()),i||(i="#FF0000");var n=[];return t("[data-map-category]").each(function(){n.push(t(this).val())}),n.indexOf(e)>-1?void alert("Category name must be unique"):(t(".interactive-map-categories-list").append('            <li data-category="'+e+'">                <span style="color:'+i+';">'+e+'</span>                <button type="button" class="button button-link" data-action="interactive-map-add-remove-category" data-category-name="'+e+'"><i class="fa fa-trash"></i></button>                                <input type="hidden" name="interactive-map-categories['+a+'][name]" value="'+e+'" data-map-category>                <input type="hidden" name="interactive-map-categories['+a+'][color]" value="'+i+'" data-map-category-color>            </li>        '),void this.updateSelectors(e,i))},e.prototype.removeCategory=function(e){t('.interactive-map-categories-list li[data-category="'+e+'"]').remove(),t('[data-map-category-selector] option[value="'+e+'"]').remove()},new e}(jQuery);var ModularityInteractiveMap=ModularityInteractiveMap||{};ModularityInteractiveMap.MapPins=function(t){function e(){t('[data-action="interactive-map-add-pin"]').on("click",function(t){t.preventDefault(),this.addPin()}.bind(this)),t(document).on("click",".map-pin",function(e){e.preventDefault(),t(e.target).closest('[data-action="interactive-map-pin-close"]').length||this.showPin(e.target)}.bind(this)),t(document).on("click",function(e){t(e.target).closest(".map-pin").length||this.hidePins()}.bind(this)),t(document).on("click",'[data-action="interactive-map-pin-close"]',function(t){t.preventDefault(),this.hidePins()}.bind(this)),t(document).on("click",'[data-action="interactive-map-pin-remove"]',function(t){this.removePin(t.target)}.bind(this))}var a,i=0;return e.prototype.addPin=function(e,n,o,p,r,c){a||(a=ModularityInteractiveMap.MapPinCategories.getAll()),"undefined"==typeof c&&(c=""),0===i&&(i=t("#map-image .map-container .map-pin").length),i++,"undefined"==typeof e&&(e=0),"undefined"==typeof n&&(n=0),"undefined"==typeof o&&(o=""),"undefined"==typeof p&&(p=""),"undefined"==typeof r&&(r="");var d="";c&&(d="background-color:"+a[c].color+";");var l=t('            <div class="map-pin" data-pin-id="'+i+'" style="position: absolute;top: '+e+";left: "+n+";"+d+'">                <div class="map-pin-popup">                    <input type="text" name="interactive-map-pin['+i+'][title]" class="widefat" placeholder="'+ModInteractiveMapLang.title+'…" value="'+o+'">                    <input type="text" name="interactive-map-pin['+i+'][link]" class="widefat" placeholder="'+ModInteractiveMapLang.link+'…" value="'+p+'">                    <textarea name="interactive-map-pin['+i+'][text]" class="widefat" placeholder="'+ModInteractiveMapLang.description+'…">'+r+"</textarea>                    "+ModularityInteractiveMap.MapPinCategories.getSelector("interactive-map-pin["+i+"][category]",c)+'                    <div class="pin-actions">                        <button class="button button-link" type="button" data-action="interactive-map-pin-remove">'+ModInteractiveMapLang.remove+'</button>                        <button class="button" type="button" data-action="interactive-map-pin-close">'+ModInteractiveMapLang.close+'</button>                    </div>                </div>                                <input type="hidden" name="interactive-map-pin['+i+'][top]" value="'+e+'" data-map-pin-top>                <input type="hidden" name="interactive-map-pin['+i+'][left]" value="'+n+'" data-map-pin-left>            </div>        ');l.draggable({containment:"parent",start:function(){ModularityInteractiveMap.MapPins.hidePins()},stop:function(e,a){t(this).find("[data-map-pin-top]").val(parseInt(t(this).css("top"))/(t("#map-image .map-container").height()/100)+"%"),t(this).find("[data-map-pin-left]").val(parseInt(t(this).css("left"))/(t("#map-image .map-container").width()/100)+"%")}}),l.appendTo("#map-image .map-container")},e.prototype.showPin=function(e){this.hidePins();var a=t(e).closest(".map-pin");a.find(".map-pin-popup").show()},e.prototype.hidePin=function(e){var a=t(e).closest(".map-pin");a.find(".map-pin-popup").hide()},e.prototype.hidePins=function(){t(".map-pin-popup").hide()},e.prototype.removePin=function(e){t(e).closest('[data-action="interactive-map-pin-remove"]').parents(".map-pin").remove()},new e}(jQuery);