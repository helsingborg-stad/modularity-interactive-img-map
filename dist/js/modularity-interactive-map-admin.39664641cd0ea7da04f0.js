var ModularityInteractiveMap;(()=>{var a={992:()=>{var a,t=jQuery;function e(n){if(a)return a.open(),void t(".media-router a:first-of-type").trigger("click");!function(){(a=wp.media({title:"Map image",button:{text:"Select"},multiple:!1})).on("select",function(){var t=a.state().get("selection").first().toJSON();void 0!==t&&i(t)}.bind(this)),e()}()}function i(a){t("[data-map-editor-no-map]").hide(),t("[data-map-editor]").show(),void 0!==a&&(t("#map-image .map-container").append('<img src="'+a.url+'" data-layer-id="'+a.id+'">'),t(".no-map").remove(),t("#map-layers").append('<li data-layer-id="'+a.id+'">                <input type="hidden" name="interactive-map-layers['+a.id+'][id]" value="'+a.id+'">                <input type="text" name="interactive-map-layers['+a.id+'][name]" value="'+a.title+'">                '+ModularityInteractiveMap.MapPinCategories.getMultiSelector("interactive-map-layers["+a.id+"][category]",null,null)+'                <div class="actions">                    <button type="button" class="button button-link" data-action="interactive-map-toggle-layer" data-layer-id="'+a.id+'"><span class="dashicons dashicons-hidden"></span></button>                    <button type="button" class="button button-link" data-action="interactive-map-remove-layer" data-layer-id="'+a.id+'"><span class="dashicons dashicons-trash"></span></button>                </div>            </li>'))}t(document).ready(function(){!function(){t('[data-action="interactive-map-add-layer"]').on("click",function(a){a.preventDefault(),e()}.bind(this)),t('[data-action="interactive-map-remove-image"]').on("click",function(a){a.preventDefault(),t("[data-map-editor-no-map]").show(),t("[data-map-editor]").hide(),t("#map-image .map-container img").remove(),t('[name="interactive-map-image-id"]').val("")}.bind(this)),t(document).on("click",'[data-action="interactive-map-remove-layer"]',function(a){var e;e=t(a.target).closest("button").attr("data-layer-id"),t('[data-layer-id="'+e+'"]').remove()}.bind(this)),t(document).on("click",'[data-action="interactive-map-toggle-layer"]',function(a){!function(a,e){if(t('img[data-layer-id="'+a+'"]').is(":visible"))return e.find(".fa").removeClass("fa-eye-slash").addClass("fa-eye"),void t('img[data-layer-id="'+a+'"]').hide();e.find(".fa").removeClass("fa-eye").addClass("fa-eye-slash"),t('img[data-layer-id="'+a+'"]').show()}(t(a.target).closest("button").attr("data-layer-id"),t(a.target).closest("button"))}.bind(this)),1==t('[name="interactive-map-is-selected"]').val()&&(i(),t(document).ready(function(){t("#map-layers li").each(function(){var a=t(this).attr("data-layer-id"),e=t(this).attr("data-layer-category");a&&t(this).find(".actions").before(ModularityInteractiveMap.MapPinCategories.getMultiSelector("interactive-map-layers["+a+"][category]",e,null))})}))}()})}},t={};function e(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return a[i](o,o.exports,e),o.exports}e.d=(a,t)=>{for(var i in t)e.o(t,i)&&!e.o(a,i)&&Object.defineProperty(a,i,{enumerable:!0,get:t[i]})},e.o=(a,t)=>Object.prototype.hasOwnProperty.call(a,t),e.r=a=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var i={};(()=>{"use strict";e.r(i),e.d(i,{MapPinCategories:()=>a,MapPins:()=>l});const a={addCategory:d,getAll:p,getSelector:function(a,t,e){void 0===t&&(t=null),void 0===e&&(e="widefat");var i=p("numeric"),n=c('<select class="'+e+'" name="'+a+'" data-map-category-selector></select>');return n.append('<option value="" selected>-</option>'),c.each(i,function(a,e){e.name!==t?n.append('<option style="color:'+e.color+';" value="'+e.name+'" data-color="'+e.color+'">'+e.name+"</option>"):n.append('<option style="color:'+e.color+';" value="'+e.name+'" data-color="'+e.color+'" selected>'+e.name+"</option>")}.bind(this)),n[0].outerHTML},getMultiSelector:function(a,t){o++,void 0===t&&(t=null),t&&(t=t.split("|"));var e=p("numeric"),i=c('<div class="ms-wrapper"><input class="ms-toggle" type="checkbox" id="dropdownopen-'+o+'"><label class="ms-placeholder" for="dropdownopen-'+o+'">Välj kategorier</label></div>'),n=c('<div class="ms-options"></div>');return c.each(e,function(e,i){t&&t.indexOf(i.name)>-1?n.append('<label data-category="'+i.name+'"><input type="checkbox" name="'+a+'[]" value="'+i.name+'" checked> <span>'+i.name+"</span></label>"):n.append('<label data-category="'+i.name+'"><input type="checkbox" name="'+a+'[]" value="'+i.name+'"> <span>'+i.name+"</span></label>")}.bind(this)),i.append(n),i[0].outerHTML}};var t,n=0,o=0,c=jQuery;function r(a){if(t)return t.open(),void c(".media-router a:first-of-type").trigger("click");!function(){(t=wp.media({title:"Pin icon",button:{text:"Select"},multiple:!1})).on("select",function(){var a=t.state().get("selection").first().toJSON();void 0!==a&&("image/svg+xml"===a.mime?(c("#map-category-pin-icon > svg").hide(),c('[name="map-category-pin-icon"]').attr("src",a.url).attr("data-layer-id",a.id)):alert("Only icons of file type SVG are allowed"))}.bind(this)),r()}()}function p(a){void 0===a&&(a="name");var t=[];return c(".interactive-map-categories-list li").each(function(e,i){var n=c(this).find("[data-map-category]").val(),o=c(this).find("[data-map-category-color]").val(),r=c(this).find("[data-map-category-pin-icon]").val(),p=c(this).find("[data-map-category-svg]").val(),d=[];d.name=n,d.color=o,d.icon=r,d.svg=p,"numeric"===a?t.push(d):t[n]=d}),t}function d(a,t,e,i){if(0===n&&(n=c(".interactive-map-categories-list li").length),n++,void 0===a&&(a=c('[name="map-category-name"]').val()),void 0===t&&(t=c('[name="map-category-pin-color"]').val()),void 0===e&&(e=void 0!==c('[name="map-category-pin-icon"]').attr("src")?c('[name="map-category-pin-icon"]').attr("src"):""),void 0===i&&(i='<img src="'+e+'">'),t||(t="#FF0000"),a){var o=[];c("[data-map-category]").each(function(){o.push(c(this).val())}),o.indexOf(a)>-1?alert("Category name must be unique"):(c(".interactive-map-categories-list").append('            <li data-category="'+a+'">                <span style="color:'+t+';">'+a+'</span>                <button type="button" class="button button-link" data-action="interactive-map-add-remove-category" data-category-name="'+a+'"><span class="dashicons dashicons-trash"></button>                <button type="button" class="button button-link" data-action="interactive-map-add-edit-category" data-category-name="'+a+'"><span class="dashicons dashicons-edit"></span></button>                                <input type="hidden" name="interactive-map-categories['+n+'][name]" value="'+a+'" data-map-category>                <input type="hidden" name="interactive-map-categories['+n+'][color]" value="'+t+'" data-map-category-color>                <input type="hidden" name="interactive-map-categories['+n+'][icon]" value="'+e+'" data-map-category-pin-icon>                <input type="hidden" value=\''+i+"' data-map-category-svg>            </li>        "),function(a,t){c("[data-map-category-selector]").append('<option style="color:'+t+';" value="'+a+'" data-color="'+t+'">'+a+"</option>");var e=c(".ms-wrapper .ms-options label:first").clone();e.attr("data-category",a),e.find('input[type="checkbox"]').val(a),e.find("span").text(a),e.appendTo(".ms-wrapper .ms-options")}(a,t))}else alert("You need to give your category a unique name")}c(document).ready(function(){!function(){c('[data-action="interactive-map-add-pin-category"]').on("click",function(a){a.preventDefault(),d()}.bind(this)),c(document).on("click",'[data-action="interactive-map-add-remove-category"]',function(a){var t;a.preventDefault(),t=c(a.target).closest('[data-action="interactive-map-add-remove-category"]').attr("data-category-name"),c('.interactive-map-categories-list li[data-category="'+t+'"]').remove(),c('[data-map-category-selector] option[value="'+t+'"]').remove()}.bind(this)),c(document).on("change",".map-pin [data-map-category-selector]",function(a){var t=c("option:selected",this).text(),e=p(),i=c(this).parents(".map-pin"),n=c(this).find("option:selected").attr("data-color");c("svg",i).replaceWith(e[t].svg),c("svg",i).css("fill",n)}),c(document).on("click",'[data-action="interactive-map-add-edit-category"]',function(a){var t,e,i,n;a.preventDefault(),t=c(a.target).closest('[data-action="interactive-map-add-edit-category"]').attr("data-category-name"),e=c(".interactive-map-categories-form"),i=c(".interactive-map-categories-form-edit"),n=c('.interactive-map-categories-list li[data-category="'+t+'"]'),i.find('[name="map-category-name-before"]').val(t),i.find('[name="map-category-name"]').val(n.find('input[name*="name"]').val()),i.find('[name="map-category-pin-color"]').val(n.find('input[name*="color"]').val()),i.find('[name="map-category-pin-icon"]').attr("src",n.find('input[name*="icon"]').val()),n.find('input[name*="icon"]').val()?(c("svg",i).hide(),c('[data-action="interactive-map-remove-icon"]').show()):(c("svg",i).show(),c('[data-action="interactive-map-remove-icon"]').hide()),e.hide(),i.show()}.bind(this)),c('[data-action="interactive-map-stop-edit-pin-category"]').on("click",function(a){a.preventDefault(),c(".interactive-map-categories-form").show(),c(".interactive-map-categories-form-edit").hide()}),c('[data-action="interactive-map-edit-pin-category"]').on("click",function(a){a.preventDefault(),function(){var a=c(".interactive-map-categories-form"),t=c(".interactive-map-categories-form-edit"),e=t.find('[name="map-category-name-before"]').val(),i=t.find('[name="map-category-name"]').val(),n=t.find('[name="map-category-pin-color"]').val(),o=t.find('[name="map-category-pin-icon"]').attr("src"),r=c('.interactive-map-categories-list li[data-category="'+e+'"]');if(n||(n="#FF0000"),i){var p=[];c("[data-map-category]").each(function(){p.push(c(this).val())}),p.indexOf(i)>-1&&i!==e?alert("Category name must be unique"):(r.attr("data-category",i),r.find("[data-category-name]").attr("data-category-name",i),r.find("span").text(i),r.find('input[name*="name"]').val(i).attr("data-map-category",i),r.find('input[name*="color"]').val(n).attr("data-map-category-color",n),r.find('input[name*="icon"]').val(o).attr("data-map-category-color",n),c("[data-map-category-selector]").each(function(a,t){var o=c(t);o.find('option[value="'+e+'"]').val(i).text(i).css("color",n),o.val()==e&&o.parents(".map-pin").css("fill",n)}),c(".ms-wrapper").each(function(a,t){var n=c(t).find('.ms-options label[data-category="'+e+'"]');n.attr("data-category",i),n.find("input").val(i),n.find("span").text(i)}),a.show(),t.hide())}else alert("You need to give your category a unique name")}()}.bind(this)),c('[data-action="interactive-map-add-icon"]').on("click",function(a){a.preventDefault(),r()}.bind(this)),c('[data-action="interactive-map-remove-icon"]').on("click",function(a){a.preventDefault(),c(a.target).hide(),c("#map-category-pin-icon > svg","").show(),c('[name="map-category-pin-icon"]').attr("src","")}.bind(this))}()});const l={addPin:u};var s,m=0,v=jQuery;function u(a,t,e,i,n,o){s||(s=ModularityInteractiveMap.MapPinCategories.getAll()),void 0===o&&(o=""),0===m&&(m=v("#map-image .map-container .map-pin").length),m++,void 0===a&&(a=0),void 0===t&&(t=0),void 0===e&&(e=""),void 0===i&&(i=""),void 0===n&&(n="");var c=v('<div><svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><circle cx="100" cy="100" r="100"/></svg></div>');o&&(s[o].svg&&(c=v("<div>"+s[o].svg+"</div>")),v("svg",c).css({fill:s[o].color}));var r=v('            <div class="map-pin" data-pin-id="'+m+'" style="position: absolute;top: '+a+";left: "+t+';">            '+c.html()+'                <div class="map-pin-popup">                    <input type="text" name="interactive-map-pin['+m+'][title]" class="widefat" placeholder="'+ModInteractiveMapLang.title+'…" value="'+e+'">                    <input type="text" name="interactive-map-pin['+m+'][link]" class="widefat" placeholder="'+ModInteractiveMapLang.link+'…" value="'+i+'">                    <textarea name="interactive-map-pin['+m+'][text]" class="widefat" placeholder="'+ModInteractiveMapLang.description+'…">'+n+"</textarea>                    "+ModularityInteractiveMap.MapPinCategories.getSelector("interactive-map-pin["+m+"][category]",o)+'                    <div class="pin-actions">                        <button class="button button-link" type="button" data-action="interactive-map-pin-remove">'+ModInteractiveMapLang.remove+'</button>                        <button class="button" type="button" data-action="interactive-map-pin-close">'+ModInteractiveMapLang.close+'</button>                    </div>                </div>                                <input type="hidden" name="interactive-map-pin['+m+'][top]" value="'+a+'" data-map-pin-top>                <input type="hidden" name="interactive-map-pin['+m+'][left]" value="'+t+'" data-map-pin-left>            </div>        ');r.draggable({containment:"parent",start:function(){g()},stop:function(a,t){v(this).find("[data-map-pin-top]").val(parseInt(v(this).css("top"))/(v("#map-image .map-container").height()/100)+"%"),v(this).find("[data-map-pin-left]").val(parseInt(v(this).css("left"))/(v("#map-image .map-container").width()/100)+"%")}}),r.appendTo("#map-image .map-container")}function g(){v(".map-pin-popup").hide()}v(document).ready(function(){!function(){v('[data-action="interactive-map-add-pin"]').on("click",function(a){a.preventDefault(),u()}.bind(this)),v(document).on("click",".map-pin",function(a){var t;a.preventDefault(),v(a.target).closest('[data-action="interactive-map-pin-close"]').length||(t=a.target,g(),v(t).closest(".map-pin").find(".map-pin-popup").show())}.bind(this)),v(document).on("click",function(a){v(a.target).closest(".map-pin").length||g()}.bind(this)),v(document).on("click",'[data-action="interactive-map-pin-close"]',function(a){a.preventDefault(),g()}.bind(this)),v(document).on("click",'[data-action="interactive-map-pin-remove"]',function(a){var t;t=a.target,v(t).closest('[data-action="interactive-map-pin-remove"]').parents(".map-pin").remove()}.bind(this))}()}),e(992)})(),ModularityInteractiveMap=i})();
//# sourceMappingURL=modularity-interactive-map-admin.39664641cd0ea7da04f0.js.map